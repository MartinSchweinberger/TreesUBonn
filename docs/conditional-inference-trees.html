<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Conditional Inference Trees | An introduction to conditional inference trees in R</title>
  <meta name="description" content="Conditional Inference Trees | An introduction to conditional inference trees in R" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Conditional Inference Trees | An introduction to conditional inference trees in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Conditional Inference Trees | An introduction to conditional inference trees in R" />
  
  
  

<meta name="author" content="Martin Schweinberger" />


<meta name="date" content="2023-01-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basics-of-tree-based-models.html"/>
<link rel="next" href="practice.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Conditional Inference Trees in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-me"><i class="fa fa-check"></i>About me</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-workshop"><i class="fa fa-check"></i>About the workshop</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation-session-info"><i class="fa fa-check"></i>Citation &amp; Session Info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="basics-of-tree-based-models.html"><a href="basics-of-tree-based-models.html"><i class="fa fa-check"></i>Basics of tree-based models</a>
<ul>
<li class="chapter" data-level="" data-path="basics-of-tree-based-models.html"><a href="basics-of-tree-based-models.html#advantages"><i class="fa fa-check"></i>Advantages</a></li>
<li class="chapter" data-level="" data-path="basics-of-tree-based-models.html"><a href="basics-of-tree-based-models.html#problems"><i class="fa fa-check"></i>Problems</a></li>
<li class="chapter" data-level="" data-path="basics-of-tree-based-models.html"><a href="basics-of-tree-based-models.html#classification-and-regression-trees"><i class="fa fa-check"></i>Classification And Regression Trees</a></li>
<li class="chapter" data-level="" data-path="basics-of-tree-based-models.html"><a href="basics-of-tree-based-models.html#how-tree-based-methods-work"><i class="fa fa-check"></i>How Tree-Based Methods Work</a></li>
<li class="chapter" data-level="" data-path="basics-of-tree-based-models.html"><a href="basics-of-tree-based-models.html#splitting-numeric-ordinal-and-true-categorical-variables"><i class="fa fa-check"></i>Splitting numeric, ordinal, and true categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="conditional-inference-trees.html"><a href="conditional-inference-trees.html"><i class="fa fa-check"></i>Conditional Inference Trees</a>
<ul>
<li class="chapter" data-level="" data-path="conditional-inference-trees.html"><a href="conditional-inference-trees.html#example-1-disourse-like"><i class="fa fa-check"></i>Example 1: disourse like</a></li>
<li class="chapter" data-level="" data-path="conditional-inference-trees.html"><a href="conditional-inference-trees.html#example-2-prepositions"><i class="fa fa-check"></i>Example 2: Prepositions</a></li>
<li class="chapter" data-level="" data-path="conditional-inference-trees.html"><a href="conditional-inference-trees.html#prettifying-your-cit-tree"><i class="fa fa-check"></i>Prettifying your CIT tree</a></li>
<li class="chapter" data-level="" data-path="conditional-inference-trees.html"><a href="conditional-inference-trees.html#extensions-of-conditional-inference-trees"><i class="fa fa-check"></i>Extensions of Conditional Inference Trees</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="practice.html"><a href="practice.html"><i class="fa fa-check"></i>Practice</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An introduction to conditional inference trees in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="conditional-inference-trees" class="section level1 unnumbered hasAnchor">
<h1>Conditional Inference Trees<a href="conditional-inference-trees.html#conditional-inference-trees" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Conditional Inference Trees (CITs) are much better at determining the <em>true</em> effect of a predictor, i.e. the effect of a predictor if all other effects are simultaneously considered. In contrast to CARTs, CITs use p-values to determine splits in the data. Below is a conditional inference tree which shows how and what factors contribute to the use of discourse <em>like</em>. In conditional inference trees predictors are only included if the predictor is significant (i.e. if these predictors are necessary).</p>
<div id="example-1-disourse-like" class="section level2 unnumbered hasAnchor">
<h2>Example 1: disourse like<a href="conditional-inference-trees.html#example-1-disourse-like" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In a first step, we load the data (in this case, the data is stored online and made available via the LADAL github repo).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="conditional-inference-trees.html#cb30-1" aria-hidden="true" tabindex="-1"></a>citdata <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;https://slcladal.github.io/data/treedata.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb30-2"><a href="conditional-inference-trees.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the data (head shows the first 6 lines)</span></span>
<span id="cb30-3"><a href="conditional-inference-trees.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(citdata)</span></code></pre></div>
<pre><code>##     Age Gender Status LikeUser
## 1 15-40 female   high       no
## 2 15-40 female   high       no
## 3 15-40   male   high       no
## 4 41-80 female    low      yes
## 5 41-80   male   high       no
## 6 41-80   male    low       no</code></pre>
<p>We can also inspect the structure of the data using the <code>str()</code> function as shown below.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="conditional-inference-trees.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the data (str shows the structure of the data)</span></span>
<span id="cb32-2"><a href="conditional-inference-trees.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(citdata)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    251 obs. of  4 variables:
##  $ Age     : chr  &quot;15-40&quot; &quot;15-40&quot; &quot;15-40&quot; &quot;41-80&quot; ...
##  $ Gender  : chr  &quot;female&quot; &quot;female&quot; &quot;male&quot; &quot;female&quot; ...
##  $ Status  : chr  &quot;high&quot; &quot;high&quot; &quot;high&quot; &quot;low&quot; ...
##  $ LikeUser: chr  &quot;no&quot; &quot;no&quot; &quot;no&quot; &quot;yes&quot; ...</code></pre>
<p>We can see that all variables are character variables (indicated by the <code>chr</code> next to the variable name). However, CITs require factors (not character strings) and we thus need to convert the variables into factors (which we can do using <code>mutate_if(is.character, factor)</code>)</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="conditional-inference-trees.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert character strings to factors</span></span>
<span id="cb34-2"><a href="conditional-inference-trees.html#cb34-2" aria-hidden="true" tabindex="-1"></a>citdata <span class="ot">&lt;-</span> citdata <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="conditional-inference-trees.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.character, factor)</span>
<span id="cb34-4"><a href="conditional-inference-trees.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the data (str shows the structure of the data)</span></span>
<span id="cb34-5"><a href="conditional-inference-trees.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(citdata)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    251 obs. of  4 variables:
##  $ Age     : Factor w/ 2 levels &quot;15-40&quot;,&quot;41-80&quot;: 1 1 1 2 2 2 2 1 2 2 ...
##  $ Gender  : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 1 1 2 1 2 2 1 2 2 2 ...
##  $ Status  : Factor w/ 2 levels &quot;high&quot;,&quot;low&quot;: 1 1 1 2 1 2 2 1 2 2 ...
##  $ LikeUser: Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 1 2 1 1 2 1 1 1 ...</code></pre>
<p>Now we can implement the CIT. We start by defining a so-called control which allows us to model that we are running several test in one go. Setting a control in this case means that we lower the significance levels so that the overall significance level (of all test combined is still at <span class="math inline">\(\alpha\)</span> = .05 (this prevents errors in our analysis called <em>false positives</em>).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="conditional-inference-trees.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># apply bonferroni correction (1 minus alpha multiplied by n of predictors)</span></span>
<span id="cb36-2"><a href="conditional-inference-trees.html#cb36-2" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">ctree_control</span>(<span class="at">mincriterion =</span> <span class="dv">1</span><span class="sc">-</span>(.<span class="dv">05</span><span class="sc">*</span><span class="fu">ncol</span>(citdata)<span class="sc">-</span><span class="dv">1</span>))</span></code></pre></div>
<p>After setting the control, we implement the CIT by using the <code>ctree</code> function from the <code>partykit</code> package. This function requires the formula (the dependent variable ~ and the independent variables) and the specification of the data. Then, we plot the resulting CIT using the <code>plot</code> function.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="conditional-inference-trees.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create initial conditional inference tree model</span></span>
<span id="cb37-2"><a href="conditional-inference-trees.html#cb37-2" aria-hidden="true" tabindex="-1"></a>citd.ctree <span class="ot">&lt;-</span> partykit<span class="sc">::</span><span class="fu">ctree</span>(LikeUser <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Status,</span>
<span id="cb37-3"><a href="conditional-inference-trees.html#cb37-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> citdata)</span>
<span id="cb37-4"><a href="conditional-inference-trees.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(citd.ctree, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">8</span>)) <span class="co"># plot final ctree</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/cita6-1.png" width="672" /></p>
</div>
<div id="example-2-prepositions" class="section level2 unnumbered hasAnchor">
<h2>Example 2: Prepositions<a href="conditional-inference-trees.html#example-2-prepositions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We now proceed with a different example that uses a numeric dependent variable. In this example, we want to see what factors impact the use of prepositions across time in historical texts. The analysis is based on data extracted from the <em>Penn Corpora of Historical English</em> (see <a href="http://www.ling.upenn.edu/hist-corpora/" class="uri">http://www.ling.upenn.edu/hist-corpora/</a>), that consists of 603 texts written between 1125 and 1900.</p>
<p>Be start again by loading the data.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="conditional-inference-trees.html#cb38-1" aria-hidden="true" tabindex="-1"></a>pvd  <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">readRDS</span>(<span class="fu">url</span>(<span class="st">&quot;https://slcladal.github.io/data/pvd.rda&quot;</span>, <span class="st">&quot;rb&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="conditional-inference-trees.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.character, factor) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="conditional-inference-trees.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove columns we do not need</span></span>
<span id="cb38-4"><a href="conditional-inference-trees.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Date, <span class="sc">-</span>Genre, <span class="sc">-</span>Text)</span>
<span id="cb38-5"><a href="conditional-inference-trees.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb38-6"><a href="conditional-inference-trees.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pvd); <span class="fu">str</span>(pvd)</span></code></pre></div>
<pre><code>##   Prepositions Region     GenreRedux DateRedux
## 1       166.01  North     NonFiction 1700-1799
## 2       139.86  North     NonFiction 1700-1799
## 3       130.78  North Conversational 1800-1913
## 4       151.29  North     NonFiction 1800-1913
## 5       145.72  North     NonFiction 1700-1799
## 6       120.77  North     NonFiction 1800-1913</code></pre>
<pre><code>## &#39;data.frame&#39;:    537 obs. of  4 variables:
##  $ Prepositions: num  166 140 131 151 146 ...
##  $ Region      : Factor w/ 2 levels &quot;North&quot;,&quot;South&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ GenreRedux  : Factor w/ 5 levels &quot;Conversational&quot;,..: 4 4 1 4 4 4 1 4 4 1 ...
##  $ DateRedux   : Factor w/ 5 levels &quot;1150-1499&quot;,&quot;1500-1599&quot;,..: 4 4 5 5 4 5 5 5 4 4 ...</code></pre>
<p>Next, we set the control just like we did before.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="conditional-inference-trees.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># apply bonferroni correction (1 minus alpha multiplied by n of predictors)</span></span>
<span id="cb41-2"><a href="conditional-inference-trees.html#cb41-2" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">ctree_control</span>(<span class="at">mincriterion =</span> <span class="dv">1</span><span class="sc">-</span>(.<span class="dv">05</span><span class="sc">*</span><span class="fu">ncol</span>(pvd)<span class="sc">-</span><span class="dv">1</span>))</span></code></pre></div>
<p>Now, we implement the CIT and plot the results.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="conditional-inference-trees.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create initial conditional inference tree model</span></span>
<span id="cb42-2"><a href="conditional-inference-trees.html#cb42-2" aria-hidden="true" tabindex="-1"></a>citd.ctree2 <span class="ot">&lt;-</span> partykit<span class="sc">::</span><span class="fu">ctree</span>(Prepositions <span class="sc">~</span> DateRedux <span class="sc">+</span> Region <span class="sc">+</span> GenreRedux,</span>
<span id="cb42-3"><a href="conditional-inference-trees.html#cb42-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pvd)</span>
<span id="cb42-4"><a href="conditional-inference-trees.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(citd.ctree2, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">8</span>)) <span class="co"># plot final ctree</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/citb6-1.png" width="672" /></p>
</div>
<div id="prettifying-your-cit-tree" class="section level2 unnumbered hasAnchor">
<h2>Prettifying your CIT tree<a href="conditional-inference-trees.html#prettifying-your-cit-tree" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The easiest and most common way to visualize CITs is to simply use the <code>plot</code> function from <code>base R</code>. However, using this function does not allow to adapt and customize the visualization except for some very basic parameters. The <code>ggparty</code> function allows to use the <code>ggplot</code> syntax to customize CITs which allows more adjustments and is more aesthetically pleasing.</p>
<p>To generate this customized CIT, we activate the <code>ggparty</code> package and extract the significant p-values from the CIT object. We then plot the CIT and define the nodes, edges, and text elements as shown below.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="conditional-inference-trees.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract p-values</span></span>
<span id="cb43-2"><a href="conditional-inference-trees.html#cb43-2" aria-hidden="true" tabindex="-1"></a>pvals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nodeapply</span>(citd.ctree, <span class="at">ids =</span> <span class="fu">nodeids</span>(citd.ctree), <span class="cf">function</span>(n) <span class="fu">info_node</span>(n)<span class="sc">$</span>p.value))</span>
<span id="cb43-3"><a href="conditional-inference-trees.html#cb43-3" aria-hidden="true" tabindex="-1"></a>pvals <span class="ot">&lt;-</span> pvals[pvals <span class="sc">&lt;</span>.<span class="dv">05</span>]</span>
<span id="cb43-4"><a href="conditional-inference-trees.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb43-5"><a href="conditional-inference-trees.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparty</span>(citd.ctree) <span class="sc">+</span></span>
<span id="cb43-6"><a href="conditional-inference-trees.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge</span>() <span class="sc">+</span></span>
<span id="cb43-7"><a href="conditional-inference-trees.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_label</span>() <span class="sc">+</span></span>
<span id="cb43-8"><a href="conditional-inference-trees.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="at">line_list =</span> <span class="fu">list</span>(<span class="fu">aes</span>(<span class="at">label =</span> splitvar),</span>
<span id="cb43-9"><a href="conditional-inference-trees.html#cb43-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;N=&quot;</span>, nodesize, <span class="st">&quot;, p&quot;</span>, </span>
<span id="cb43-10"><a href="conditional-inference-trees.html#cb43-10" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">ifelse</span>(pvals <span class="sc">&lt;</span> .<span class="dv">001</span>, <span class="st">&quot;&lt;.001&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">round</span>(pvals, <span class="dv">3</span>)))), </span>
<span id="cb43-11"><a href="conditional-inference-trees.html#cb43-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">size =</span> <span class="dv">10</span>)),</span>
<span id="cb43-12"><a href="conditional-inference-trees.html#cb43-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">line_gpar =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">size =</span> <span class="dv">13</span>), </span>
<span id="cb43-13"><a href="conditional-inference-trees.html#cb43-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">10</span>)), </span>
<span id="cb43-14"><a href="conditional-inference-trees.html#cb43-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ids =</span> <span class="st">&quot;inner&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-15"><a href="conditional-inference-trees.html#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;Node &quot;</span>, id, <span class="st">&quot;, N = &quot;</span>, nodesize)),</span>
<span id="cb43-16"><a href="conditional-inference-trees.html#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="st">&quot;terminal&quot;</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.0</span>, <span class="at">nudge_x =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb43-17"><a href="conditional-inference-trees.html#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_plot</span>(<span class="at">gglist =</span> <span class="fu">list</span>(</span>
<span id="cb43-18"><a href="conditional-inference-trees.html#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> LikeUser),</span>
<span id="cb43-19"><a href="conditional-inference-trees.html#cb43-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_fill</span>(), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb43-20"><a href="conditional-inference-trees.html#cb43-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(),</span>
<span id="cb43-21"><a href="conditional-inference-trees.html#cb43-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray50&quot;</span>, <span class="st">&quot;gray80&quot;</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>),</span>
<span id="cb43-22"><a href="conditional-inference-trees.html#cb43-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb43-23"><a href="conditional-inference-trees.html#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>), </span>
<span id="cb43-24"><a href="conditional-inference-trees.html#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Probability&quot;</span>),</span>
<span id="cb43-25"><a href="conditional-inference-trees.html#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">group =</span> LikeUser,</span>
<span id="cb43-26"><a href="conditional-inference-trees.html#cb43-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="fu">stat</span>(count)),</span>
<span id="cb43-27"><a href="conditional-inference-trees.html#cb43-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>, <span class="at">position =</span> <span class="fu">position_fill</span>(), <span class="at">vjust =</span> <span class="fl">1.1</span>)),</span>
<span id="cb43-28"><a href="conditional-inference-trees.html#cb43-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">shared_axis_labels =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/pretty-1.png" width="672" /></p>
<p>We can also use <code>position_dodge</code> (instead of <code>position_fill</code>) to display frequencies rather than probabilities as shown below.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="conditional-inference-trees.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb44-2"><a href="conditional-inference-trees.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparty</span>(citd.ctree) <span class="sc">+</span></span>
<span id="cb44-3"><a href="conditional-inference-trees.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge</span>() <span class="sc">+</span></span>
<span id="cb44-4"><a href="conditional-inference-trees.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_label</span>() <span class="sc">+</span></span>
<span id="cb44-5"><a href="conditional-inference-trees.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="at">line_list =</span> <span class="fu">list</span>(<span class="fu">aes</span>(<span class="at">label =</span> splitvar),</span>
<span id="cb44-6"><a href="conditional-inference-trees.html#cb44-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;N=&quot;</span>, nodesize, <span class="st">&quot;, p&quot;</span>, </span>
<span id="cb44-7"><a href="conditional-inference-trees.html#cb44-7" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">ifelse</span>(pvals <span class="sc">&lt;</span> .<span class="dv">001</span>, <span class="st">&quot;&lt;.001&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">round</span>(pvals, <span class="dv">3</span>)))), </span>
<span id="cb44-8"><a href="conditional-inference-trees.html#cb44-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">size =</span> <span class="dv">10</span>)),</span>
<span id="cb44-9"><a href="conditional-inference-trees.html#cb44-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">line_gpar =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">size =</span> <span class="dv">13</span>), </span>
<span id="cb44-10"><a href="conditional-inference-trees.html#cb44-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">10</span>)), </span>
<span id="cb44-11"><a href="conditional-inference-trees.html#cb44-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ids =</span> <span class="st">&quot;inner&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-12"><a href="conditional-inference-trees.html#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;Node &quot;</span>, id, <span class="st">&quot;, N = &quot;</span>, nodesize)),</span>
<span id="cb44-13"><a href="conditional-inference-trees.html#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="st">&quot;terminal&quot;</span>, <span class="at">nudge_y =</span> <span class="fl">0.01</span>, <span class="at">nudge_x =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb44-14"><a href="conditional-inference-trees.html#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_plot</span>(<span class="at">gglist =</span> <span class="fu">list</span>(</span>
<span id="cb44-15"><a href="conditional-inference-trees.html#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> LikeUser),</span>
<span id="cb44-16"><a href="conditional-inference-trees.html#cb44-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb44-17"><a href="conditional-inference-trees.html#cb44-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(),</span>
<span id="cb44-18"><a href="conditional-inference-trees.html#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb44-19"><a href="conditional-inference-trees.html#cb44-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb44-20"><a href="conditional-inference-trees.html#cb44-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray50&quot;</span>, <span class="st">&quot;gray80&quot;</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>),</span>
<span id="cb44-21"><a href="conditional-inference-trees.html#cb44-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>),</span>
<span id="cb44-22"><a href="conditional-inference-trees.html#cb44-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)),</span>
<span id="cb44-23"><a href="conditional-inference-trees.html#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>), </span>
<span id="cb44-24"><a href="conditional-inference-trees.html#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Frequency&quot;</span>),</span>
<span id="cb44-25"><a href="conditional-inference-trees.html#cb44-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">group =</span> LikeUser,</span>
<span id="cb44-26"><a href="conditional-inference-trees.html#cb44-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="fu">stat</span>(count)),</span>
<span id="cb44-27"><a href="conditional-inference-trees.html#cb44-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>, </span>
<span id="cb44-28"><a href="conditional-inference-trees.html#cb44-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.7</span>)),</span>
<span id="cb44-29"><a href="conditional-inference-trees.html#cb44-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">shared_axis_labels =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/plotctree-1.png" width="672" /></p>
</div>
<div id="extensions-of-conditional-inference-trees" class="section level2 unnumbered hasAnchor">
<h2>Extensions of Conditional Inference Trees<a href="conditional-inference-trees.html#extensions-of-conditional-inference-trees" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An extension which remedies this problem is to use a so-called ensemble method which grows many varied trees. The most common ensemble method is called a <em>Random Forest Analysis</em> and, unfortunately, we cannot deal with random forests here (but if you are interested, check out <a href="https://ladal.edu.au/tree.html">this tutorial</a>).</p>
<hr />
<p><a href="https://github.com/MartinSchweinberger/TreesUBonn">Back to the workshop repo</a></p>
<hr />

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basics-of-tree-based-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="practice.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/MartinSchweinberger/TreesUBonn/edit/master/02-trees.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/MartinSchweinberger/TreesUBonn/blob/master/02-trees.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
